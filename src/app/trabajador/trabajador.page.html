<ion-header>
  <ion-toolbar color="primary">
    <ion-title>
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <img src="assets/Img/Logo_San_Bernardo.png" alt="Logo San Bernardo"
        style="height: 50px; width: 50px; margin-right: 8px; vertical-align: middle; border-radius: 4px;" />
      Trabajador
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="welcome-container">
    <h2 class="welcome-title">Bienvenido, {{ nombreUsuario || 'Trabajador' }}</h2>
    
    <!-- Mostrar rol asignado (no seleccionable) -->
    <div class="selected-info">
      <p class="info-label">Rol asignado:</p>
      <p class="info-value role-value">
        {{ rolAsignado || 'No asignado' }}
      </p>
    </div>

    <div class="content-section">
      <!-- Información del tipo de vehículo seleccionado -->
      <div class="selected-info">
        <p class="info-label">Tipo de vehículo seleccionado:</p>
        <p class="info-value vehicle-value">
          {{ tipoVehiculoSeleccionado?.nombre_tipo_vehiculo || 'No seleccionado' }}
        </p>
      </div>

      <!-- Botones para tipos de vehículos -->
      <div class="vehicle-selection">
        <ion-grid>
          <ion-row class="vehicle-row">
            <ion-col size="6" *ngFor="let tipo of tiposVehiculos">
              <ion-card [class.selected]="tipoVehiculoSeleccionado?.id_tipo_vehiculo === tipo.id_tipo_vehiculo"
                  class="vehicle-card" button (click)="selectTipoVehiculo(tipo)">
                <ion-card-content class="vehicle-card-content">
                  <!-- Iconos según el tipo de vehículo -->
                  <ion-icon *ngIf="tipo.nombre_tipo_vehiculo === 'Auto'" name="car-sport" class="vehicle-icon"></ion-icon>
                  <ion-icon *ngIf="tipo.nombre_tipo_vehiculo === 'Motocicleta'" name="bicycle" class="vehicle-icon"></ion-icon>
                  <ion-icon *ngIf="tipo.nombre_tipo_vehiculo === 'Camioneta'" name="car" class="vehicle-icon"></ion-icon>
                  <ion-icon *ngIf="tipo.nombre_tipo_vehiculo === 'Bicicleta'" name="bicycle" class="vehicle-icon"></ion-icon>
                  
                  <div class="vehicle-title">{{ tipo.nombre_tipo_vehiculo }}</div>
                </ion-card-content>
              </ion-card>
            </ion-col>
          </ion-row>
        </ion-grid>
      </div>

      <!-- Selector de vehículo (se filtra según tipo seleccionado) -->
      <div *ngIf="tipoVehiculoSeleccionado" class="form-section">
        <ion-item class="form-item">
          <ion-label position="stacked" class="form-label">Seleccionar vehículo *</ion-label>
          <ion-select [(ngModel)]="vehiculoSeleccionado" (ionChange)="onVehiculoChange()"
              interface="action-sheet" placeholder="Seleccione vehículo" class="form-select">
            <ion-select-option *ngFor="let vehiculo of vehiculosFiltrados" [value]="vehiculo">
              {{ vehiculo.patente_vehiculo }} - {{ vehiculo.marca_vehiculo }} {{ vehiculo.modelo_vehiculo }}
            </ion-select-option>
          </ion-select>
        </ion-item>
        
        <!-- Opción para escribir manualmente el código -->
        <div *ngIf="!vehiculoSeleccionado || vehiculoSeleccionado?.codigo_vehiculo === 'MANUAL'" class="manual-input-section">
          <ion-item class="form-item">
            <ion-label position="stacked" class="form-label">O escribir código manualmente</ion-label>
            <ion-input [(ngModel)]="codigoVehiculoManual" (ionInput)="onCodigoManualChange()" 
                placeholder="Ej: VH-001" maxlength="20" class="form-input"></ion-input>
          </ion-item>
        </div>
      </div>

      <!-- Selector de radio disponible -->
      <div class="form-section">
        <ion-item class="form-item">
          <ion-label position="stacked" class="form-label">Seleccionar radio disponible *</ion-label>
          <ion-select [(ngModel)]="radioSeleccionada" (ionChange)="onRadioChange()"
              interface="action-sheet" placeholder="Seleccione una radio" class="form-select">
            <ion-select-option *ngFor="let radio of radiosDisponibles" [value]="radio">
              {{ radio.nombre_radio }} ({{ radio.codigo_radio }})
            </ion-select-option>
          </ion-select>
        </ion-item>
        
        <!-- Mostrar radio seleccionada -->
        <div *ngIf="radioSeleccionada" class="selected-display">
          <p class="selected-text">
            Radio seleccionada: <strong>{{ radioSeleccionada.nombre_radio }}</strong>
          </p>
        </div>
      </div>

      <!-- Botón para iniciar turno -->
      <div class="action-section">
        <ion-button expand="block" color="primary" (click)="startTrabajo()"
          [disabled]="!isReadyToStart()" class="start-button">Iniciar turno</ion-button>
      </div>
    </div>
  </div>
</ion-content>