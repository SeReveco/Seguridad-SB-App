<ion-header>
  <ion-toolbar color="primary">
    <ion-title>
      <img src="assets/Img/Logo_San_Bernardo.png" alt="Logo San Bernardo" style="height: 50px; width: 50px; margin-right: 8px; vertical-align: middle; border-radius: 4px;" />
      Iniciar sesión
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div>
    <form (ngSubmit)="onLogin()">
      <div style="text-align: center; margin-bottom: 18px; font-size: 2.1rem; color: #fff; font-weight: 700; letter-spacing: 1px;">Bienvenido a Seguridad SB</div>

      <div style="margin-top: 16px; text-align: center; color: #ccc;">
        Para acceder a todas las funcionalidades de la plataforma, por favor inicia sesión.
      </div>

      <ion-item>
        <ion-label position="floating">Correo electrónico</ion-label>
        <ion-input 
          type="email" 
          required 
          [(ngModel)]="email" 
          name="email"
          (ionInput)="onInputChange()">
        </ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Contraseña</ion-label>
        <ion-input 
          type="password" 
          required 
          [(ngModel)]="password" 
          name="password"
          (ionInput)="onInputChange()">
        </ion-input>
      </ion-item>

      <div style="margin-top: 16px; text-align: center; color: #ccc;">
        ¿No tienes cuenta? <a routerLink="/register" style="color:#1976d2; text-decoration:underline;">Regístrate aquí</a>
      </div>

      <div style="margin-top: 24px; text-align: center;">
        <ion-button 
          expand="block" 
          color="primary" 
          type="submit"
          [disabled]="loading">
          <ion-spinner *ngIf="loading" name="crescent" style="margin-right: 8px;"></ion-spinner>
          {{ loading ? 'Iniciando sesión...' : 'Ingresar' }}
        </ion-button>
      </div>

      <div *ngIf="errorMessage" style="color: #ff6b6b; text-align: center; font-size: 1rem; margin-top: 16px; padding: 12px; background: rgba(255, 107, 107, 0.1); border-radius: 8px; font-weight: 500;">
        <ion-icon name="warning-outline" style="vertical-align: middle; margin-right: 8px;"></ion-icon>
        {{ errorMessage }}
      </div>

      <div *ngIf="loggedIn && nombreUsuario" style="color: #4caf50; text-align: center; font-size: 1rem; margin-top: 16px; padding: 12px; background: rgba(76, 175, 80, 0.1); border-radius: 8px; font-weight: 500;">
        <ion-icon name="checkmark-circle-outline" style="vertical-align: middle; margin-right: 8px;"></ion-icon>
        ¡Bienvenido, {{ nombreUsuario }}! Redirigiendo...
      </div>

      <div style="margin-top: 16px; text-align: center;">
        <img 
          src="assets/Img/San_Bernardo_Logo.png" 
          alt="Municipalidad de San Bernardo" 
          style="max-width: 40%; width: 40%; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.12); cursor: pointer;" 
          (click)="goToHome()" 
        />
      </div>

      <!-- Botón para cargar credenciales de prueba (solo desarrollo) -->
      <div style="margin-top: 16px; text-align: center;">
        <ion-button 
          expand="block" 
          color="secondary" 
          size="small"
          (click)="fillTestCredentials()">
          Cargar Credenciales de Prueba
        </ion-button>
        <ion-button 
          expand="block" 
          color="tertiary" 
          size="small"
          style="margin-top:8px;"
          (click)="fillInstitutionalTestCredentials()">
          Cargar Credenciales Institucional (prueba@sanbernardo.cl)
        </ion-button>
      </div>
    </form>
  </div>
</ion-content>